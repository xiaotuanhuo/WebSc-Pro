<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>订单分配</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}"/>
    <link rel="stylesheet" th:href="@{/lib/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
    <link rel="stylesheet" th:href="@{/iconfont/iconfont.css}">
</head>

<body>
	<div id="jg_main" >
		<fieldset class="layui-elem-field layui-field-title" style="margin: 20px;">
			<legend>机构打分</legend>
		</fieldset>
		<div class="layui-row" style="margin: 0 20px 0 20px;">
			<div class="layui-row" style="margin-top: 8px;">
				<label for="hospitalEvaluate" class="layui-form-label">评分</label>
				<div class="layui-input-block">
					<div id="jg_star"></div>
					<input type="hidden" id="jg_store">
				</div>
			</div>	
			<div class="layui-row" style="margin-top: 8px;">
	     		<label for="operativeId" class="layui-form-label">备注</label>
	     		<div class="layui-input-block">
	          		<textarea placeholder="请输入内容" class="layui-textarea" id="doc_hospitalEvaluateMemo" th:value="${doc?.hospitalEvaluateMemo}"></textarea>
	       		</div>
	     	</div>
	     	<div class="layui-row" style="margin-top: 8px;text-align: center;">
	     		<button id="btnSaveJg" class="layui-btn layui-btn-normal" onclick="saveJg()">保存</button>
	     	</div>
		</div>
	</div>
	
	<div id="dr_main" >
		<fieldset class="layui-elem-field layui-field-title" style="margin: 20px;">
			<legend>医生打分</legend>
		</fieldset>
		<div class="layui-row" style="margin: 0 20px 0 20px;">
			<div class="layui-row" style="margin-top: 8px;">
				<label for="hospitalEvaluate" class="layui-form-label">评分</label>
				<div class="layui-input-block">
					<div id="dr_star"></div>
					<input type="hidden" id="dr_store">
				</div>
			</div>	
			<div class="layui-row" style="margin-top: 8px;">
	     		<label for="doctorEvaluate" class="layui-form-label">备注</label>
	     		<div class="layui-input-block">
	          		<textarea placeholder="请输入内容" class="layui-textarea" id="doc_doctorEvaluateMemo" th:value="${doc?.doctorEvaluateMemo}"></textarea>
	       		</div>
	     	</div>
	     	<div class="layui-row" style="margin-top: 8px;text-align: center;">
	     		<button id="btnSaveDr" class="layui-btn layui-btn-normal" onclick="saveDr()">保存</button>
	     	</div>				
		</div>
	</div>
	<script th:src="@{/lib/jquery/jquery.min.js}"></script>
    <script th:src="@{/lib/layui/layui.js}"></script>
    <script th:src="@{/js/common.js}"></script>
    
	<script th:inline="javascript">
		var doc = [[${doc}]];
		var type = [[${type}]];
		layui.config({
	         base: '/lib/layui/extend/'
	     }).extend({
	         formSelects: 'formSelects-v4'
	     }).use(['form', 'layer', 'rate'], function () {
	         $ = layui.jquery;
		         var form = layui.form
		             , layer = layui.layer
		             , rate = layui.rate;
		         
	      	
	      	
	      	
	      	if(type == '0'){
	      		$("#jg_main").css("display", "");
	      		$("#dr_main").css("display", "none");
	      	}else{
	      		$("#jg_main").css("display", "none");
	      		$("#dr_main").css("display", "");
	      	}
	      	
	      	if(doc.hospitalEvaluate != null && doc.hospitalEvaluate != ''){
	      		rate.render({
		      		elem: '#jg_star'
		      		, text: true
		      		, value: doc.hospitalEvaluate
		      		, readonly: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '中等'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      		}
			      	, choose: function (value) {
		            	$("#jg_store").val(value);
		        	}
		      	})
	      		$("#doc_hospitalEvaluate").val(doc.hospitalEvaluate);
	      		$("#doc_hospitalEvaluate").attr("disabled","disabled");
	      		$("#btnSaveJg").css("display", "none");
	      	}else{
	      		rate.render({
		      		elem: '#jg_star'
		      		, text: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '中等'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      		}
			      	, choose: function (value) {
		            	$("#jg_store").val(value);
		        	}
		      	})
	      	}
	      	
	      	if(doc.doctorEvaluate != null && doc.doctorEvaluate != ''){
	      		rate.render({
		      		elem: '#dr_star'
		      		, text: true
		      		, value: doc.doctorEvaluate
		      		, readonly: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '中等'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      		}
			      	, choose: function (value) {
		            	$("#dr_store").val(value);
		        	}
		      	})
	      		$("#doc_doctorEvaluateMemo").val(doc.doctorEvaluateMemo);
	      		$("#doc_doctorEvaluateMemo").attr("disabled","disabled");
	      		$("#btnSaveDr").css("display", "none");
	      	}else{
	      		rate.render({
		      		elem: '#dr_star'
		      		, text: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '中等'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      		}
			      	, choose: function (value) {
		            	$("#dr_store").val(value);
		        	}
		      	})
	      	}
	     });
		 
		 function saveJg(){
			 $.post('/doc/save_evaluation', {'id': doc.documentId, 'evaluate':$("#dr_store").val(), 'memo':$("#doc_doctorEvaluateMemo").val(), 'type':type}, function (result) {
					var index = parent.layer.getFrameIndex(window.name); 
	          		parent.layer.close(index); 
	                parent.layer.msg("已保存", {icon: 6});
          });
		 }
		 
		 function saveDr(){
			 $.post('/doc/save_evaluation', {'id': doc.documentId, 'evaluate':$("#dr_store").val(), 'memo':$("#doc_doctorEvaluateMemo").val(), 'type':type}, function (result) {
					var index = parent.layer.getFrameIndex(window.name); 
	          		parent.layer.close(index); 
	                parent.layer.msg("已保存", {icon: 6});
             });
		 }
	</script>
	
</body>
</html>