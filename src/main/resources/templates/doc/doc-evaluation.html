<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>订单评分</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi"/>
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}"/>
    <link rel="stylesheet" th:href="@{/lib/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
    <link rel="stylesheet" th:href="@{/iconfont/iconfont.css}">
</head>

<body>
	<div id="jg_main" style="text-align: center;">
		<fieldset class="layui-elem-field layui-field-title" style="margin: 30px 30px 0 30px;">
			<legend style="font-size: 14px;margin-left: 65px;">匿名评价医生</legend>
		</fieldset>
		<div class="layui-row" style="margin: 0 20px 0 20px;">
			<div class="layui-row" style="margin-top: 8px;">
				<div class="layui-input-block" style="margin-left: 0px;">
					<div id="jg_star"></div>
					<input type="hidden" id="jg_store">
				</div>
			</div>
			<div id="showDrMainLab" style="display:none;">
				<input type="hidden" id="drLblTxt" />
				<div class="layui-row" style="text-align: left;margin-top: 5px;font: caption;">请选择标签</div>
				
				<div class="layui-row" id="dr_main_lab_1" style="text-align: left;margin-top: 10px;display:none;">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_11" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" onclick="onDrLblClick(1, 11)">服务态度好</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_21" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" onclick="onDrLblClick(1, 21)">配合度高</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_31" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;" onclick="onDrLblClick(1, 31)">术前评估及时</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_41" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;" onclick="onDrLblClick(1, 41)">术中管理平稳</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_51" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;" onclick="onDrLblClick(1, 51)">术后无并发症</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button id="dr_main_lab_1_61" type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;" onclick="onDrLblClick(1, 61)">术后无疼痛</button>
					</div>
				</div>
				
				<div class="layui-row" id="dr_main_lab_2" style="text-align: left;margin-top: 10px;display:none;">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary">服务态一般</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary">配合一般</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术前评估有遗漏</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术中管理欠妥</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术后发症少</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术后疼痛能忍受</button>
					</div>
				</div>
				
				<div class="layui-row" id="dr_main_lab_3" style="text-align: left;margin-top: 10px;display:none;">
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary">服务态度差</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary">配合度较差</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术前评估有遗漏</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术中管理较差</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术后并发症较多</button>
					</div>
					<div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
						<button type="button" class="layui-btn layui-btn-sm layui-btn-radius layui-btn-primary" style="margin-top: 10px;">术后疼痛剧烈</button>
					</div>
				</div>
			</div>	
			
			<div class="layui-row" style="margin-top: 10px;">
	     		<div class="layui-input-block" style="margin-left: 0px;">
	          		<textarea placeholder="如果有其他意见和建议，请放心填写" class="layui-textarea" id="doc_hospitalEvaluateMemo" th:value="${doc?.hospitalEvaluateMemo}"></textarea>
	       		</div>
	     	</div>
	     	<div class="layui-row" style="margin-top: 8px;text-align: center;">
	     		<button id="btnSaveJg" class="layui-btn layui-btn-normal" onclick="saveJg()">保存</button>
	     	</div>
		</div>
	</div>
	
	<div id="dr_main" style="text-align: center;">
		<fieldset class="layui-elem-field layui-field-title" style="margin: 30px 30px 0 30px;">
			<legend style="font-size: 14px;margin-left: 65px;">匿名评价机构</legend>
		</fieldset>
		<div class="layui-row" style="margin: 0 20px 0 20px;">
			<div class="layui-row" style="margin-top: 8px;">
				<div class="layui-input-block" style="margin-left: 0px;">
					<div id="dr_star"></div>
					<input type="hidden" id="dr_store">
				</div>
			</div>
			
			<div class="layui-row" style="margin-top: 10px;">
	     		<div class="layui-input-block" style="margin-left: 0px;">
	          		<textarea placeholder="如果有其他意见和建议，请放心填写" class="layui-textarea" id="doc_doctorEvaluateMemo" th:value="${doc?.doctorEvaluateMemo}"></textarea>
	       		</div>
	     	</div>
	     	<div class="layui-row" style="margin-top: 15px;">
	     		<button id="btnSaveDr" class="layui-btn layui-btn-fluid" onclick="saveDr()">保存</button>
	     	</div>				
		</div>
	</div>
	<script th:src="@{/lib/jquery/jquery.min.js}"></script>
    <script th:src="@{/lib/layui/layui.js}"></script>
    <script th:src="@{/js/common.js}"></script>
    
	<script th:inline="javascript">
		var doc = [[${doc}]];
		var type = [[${type}]];
		layui.config({
	         base: '/lib/layui/extend/'
	     }).extend({
	         formSelects: 'formSelects-v4'
	     }).use(['form', 'layer', 'rate'], function () {
	         $ = layui.jquery;
		         var form = layui.form
		             , layer = layui.layer
		             , rate = layui.rate;
		    
	      	if(type == '0'){
	      		$("#jg_main").css("display", "");
	      		$("#dr_main").css("display", "none");
	      	}else{
	      		$("#jg_main").css("display", "none");
	      		$("#dr_main").css("display", "");
	      	}
	      	
	      	if(doc.hospitalEvaluate != null && doc.hospitalEvaluate != '' && doc.hospitalEvaluate != '-1'){
	      		rate.render({
		      		elem: '#jg_star'
		      		, text: true
		      		, value: doc.hospitalEvaluate
		      		, readonly: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '一般'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      			if(value <= 0){
			      			this.span.text("无评价");
			      			$("#showDrMainLab").css("display", "none");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}else if(value == 1){
			      			this.span.text("差");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "");
			      		}else if(value == 2 || value == 3){
			      			this.span.text("一般");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}else if(value == 4 || value == 5){
			       			alert(1);
			      			this.span.text("满意");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}
		      		}
			      	, choose: function (value) {
		            	$("#jg_store").val(value);
		        	}
		      	})
	      		$("#doc_hospitalEvaluate").val(doc.hospitalEvaluate);
	      		$("#doc_hospitalEvaluate").attr("disabled","disabled");
	      		$("#btnSaveJg").css("display", "none");
	      	}else{
	      		rate.render({
		      		elem: '#jg_star'
		      		, text: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '一般'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			};
		      			if(value <= 0){
			      			this.span.text("无评价");
			      			$("#showDrMainLab").css("display", "none");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}else if(value == 1){
			      			this.span.text("差");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "");
			      		}else if(value == 2 || value == 3){
			      			this.span.text("一般");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "none");
			      			$("#dr_main_lab_2").css("display", "");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}else if(value == 4 || value == 5){
			      			this.span.text("满意");
			      			$("#showDrMainLab").css("display", "");
			      			$("#dr_main_lab_1").css("display", "");
			      			$("#dr_main_lab_2").css("display", "none");
			      			$("#dr_main_lab_3").css("display", "none");
			      		}
		      		}
			      	, choose: function (value) {
		            	$("#jg_store").val(value);
		        	}
		      	})
	      	}
	      	
	      	if(doc.doctorEvaluate != null && doc.doctorEvaluate != '' && doc.doctorEvaluate != '-1'){
	      		rate.render({
		      		elem: '#dr_star'
		      		, text: true
		      		, value: doc.doctorEvaluate
		      		, readonly: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '一般'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			  		,'0': '无评价'
		      			    	,'-1': '无评价'
		      			};
			      		if(value <= 0){
			      			this.span.text("无评价");
			      		}else if(value == 1){
			      			this.span.text("差");
			      		}else if(value == 2 || value == 3){
			      			this.span.text("一般");
			      		}else if(value == 4 || value == 5){
			      			this.span.text("满意");
			      		}
		      		}
			      	, choose: function (value) {
		            	$("#dr_store").val(value);
		        	}
		      	})
	      		$("#doc_doctorEvaluateMemo").val(doc.doctorEvaluateMemo);
	      		$("#doc_doctorEvaluateMemo").attr("disabled","disabled");
	      		$("#btnSaveDr").css("display", "none");
	      	}else{
		      	rate.render({
		      		elem: '#dr_star'
		      		, text: true
		      		, setText: function(value){ //自定义文本的回调
		      			 var arrs = {
		      			        '1': '极差'
		      			        ,'2': '差'
		      			        ,'3': '一般'
		      			        ,'4': '好'
		      			        ,'5': '极好'
		      			    	,'0': '无评价'
				      			,'-1': '无评价'
		      			};
		      		}
			      	, choose: function (value) {
		            	$("#dr_store").val(value);
		        	}
		      	})
	      	}
	     });
		 
		 function saveJg(){
			 var arrlbl = $("#drLblTxt").val();
			 $.post('/doc/save_evaluation', {'id': doc.documentId, 'oid': doc.orgId, 'qid' : doc.qaUserId, 'evaluate':$("#jg_store").val(), 'memo':$("#doc_doctorEvaluateMemo").val(), 'lid' : arrlbl, 'type':type}, function (result) {
					var index = parent.layer.getFrameIndex(window.name); 
	          		parent.layer.close(index); 
	                parent.layer.msg("已保存", {icon: 6});
          });
		 }
		 
		 function saveDr(){
			 $.post('/doc/save_evaluation', {'id': doc.documentId, 'oid': doc.orgId, 'qid' : doc.qaUserId, 'evaluate':$("#dr_store").val(), 'memo':$("#doc_doctorEvaluateMemo").val(), 'lid':'','type':type}, function (result) {
					var index = parent.layer.getFrameIndex(window.name); 
	          		parent.layer.close(index); 
	                parent.layer.msg("已保存", {icon: 6});
             });
		 }
		 
		 function onDrLblClick(lab, val){
			 var id = "#dr_main_lab_" + lab + "_" + val;
			 var lbltxt = $("#drLblTxt").val();
			 
			 if($(id).hasClass("layui-btn-warm")){
				 $(id).removeClass("layui-btn-warm");
				 
				 var arr = lbltxt.split(',');
				 var tmparr = [];
				 
				 for(var i = 0; i < arr.length; i++){
					 if(arr[i] != val){
						 tmparr.push(arr[i]);
					 }
				 }
				 
				 $("#drLblTxt").val(tmparr.join(","));
			 }else{
				 $(id).addClass("layui-btn-warm");
				 var lbltxt = $("#drLblTxt").val();
				 
				 if(lbltxt == ""){
					 lbltxt += val;
				 }else{
					 lbltxt += "," + val;
				 }
				 $("#drLblTxt").val(lbltxt);
			 }
		 }
	</script>
	
</body>
</html>